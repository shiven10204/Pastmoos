<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="">
        <meta name="author" content="">

        <title>Pod Talk Free CSS Template by TemplateMo</title>

        <!-- CSS FILES -->        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400&family=Sono:wght@200;300;400;500;700&display=swap" rel="stylesheet">
                        
        <link rel="stylesheet" href="css/bootstrap.min.css">

        <link rel="stylesheet" href="css/bootstrap-icons.css">

        <link rel="stylesheet" href="css/owl.carousel.min.css">
        
        <link rel="stylesheet" href="css/owl.theme.default.min.css">

        <link href="css/templatemo-pod-talk.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        
        <style>


.contdiv{

    margin-top: 10px;
}
.idtxt{
    display: none;
}
.billing {
			margin: 0 auto;
			width: 70%;
		}
		table {
			width: 100%;
		}
        
        </style>
<!--

TemplateMo 584 Pod Talk

https://templatemo.com/tm-584-pod-talk

-->

    </head>
    
    <body>
       
        <main>

            <nav class="navbar navbar-expand-lg">
                <div class="container">
                    <center>
                    <a class="navbar-brand me-lg-5 me-0" href="index.html">
                        <img src="images/logo final.png" class="logo-image img-fluid" alt="templatemo pod talk">
                    </a>
                </center>
                   
            </nav>
            

             <header class="site-header d-flex flex-column justify-content-center align-items-center">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-12 col-12 text-center">

                            <h2 class="mb-0" >Cart</h2>
                        </div>

                    </div>
                </div>
            </header>

<center id="listdiv">
           
            
        </center>

        <div class="billing">
            <table class="table">
                <thead>
                    <tr>
                        <th>S.no</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody class="tabody"> 


                </tbody>
                </table>
                <h3 id="total"></h3>
                <p ></p>
            
        </div>
        <center>
            <button type="button" class="btn custom-btn smoothscroll mt-3" onclick="order()" >
                Add Address
              </button>
        </center>
        
      
</main>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getDatabase, ref, set, get, child, orderByChild, equalTo, query, limitToFirst, limitToLast, startAt, endAt } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";
     
    // Paste the code from Firebase
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
apiKey: "AIzaSyBQ75mL_tGG7DHgjh3u0_n_m-H6i3Qg_xM",
authDomain: "test-pastmoos.firebaseapp.com",
databaseURL: "https://test-pastmoos-default-rtdb.firebaseio.com",
projectId: "test-pastmoos",
storageBucket: "test-pastmoos.appspot.com",
messagingSenderId: "130244640247",
appId: "1:130244640247:web:62192c97a93d81ba95c2f2",
measurementId: "G-XFD7NKTDZV"
};
     
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
     
    // Get a reference to the database service
    const db = getDatabase(app);
  
    

const dbRef = ref(getDatabase());
const hotdealRef = query(ref(db, `Cart/` ), orderByChild('phone'), equalTo(sessionStorage.getItem('userloggedin')));

get(hotdealRef).then((snapshot) => {
if (snapshot.exists()) {

var i;
var counter=(Object.keys(snapshot.val()).length);
i=0;


  
Object.keys(snapshot.val()).forEach((key) => {




  document.querySelector("#listdiv").innerHTML +=`  
  <div class="contdiv">
  <div class="col-lg-6 col-12">
                <div class="custom-block d-flex">
                    <div class="">
                        <div class="custom-block-icon-wrap">
                            <div class="section-overlay"></div>
                            <a  class="custom-block-image-wrap">
                                <img src= 
                                ${snapshot.val()[key].image}

                                
                                class="custom-block-image img-fluid" alt="" id='img${i}'>

                               
                            </a>
                        </div>

                        <div class="mt-2">
                            <a  class="btn custom-btn"  id='quant${i}'>
                                ${snapshot.val()[key].quant}
                              
                            </a>
                            &nbsp; 
                            <a  class="btn custom-btn" id= 'remove' onclick='remove(${i})' >
                              Remove
                              
                            </a>
                        </div>
                    </div>

                    <div class="custom-block-info">
                        <div class="custom-block-top d-flex mb-1">
                           
        
<!-- 
                            <small>stickies <span class="badge">45</span></small> -->
                        </div>

                        <h5 class="mb-2">
                            <a  id='prodname${i}' value=' ${snapshot.val()[key].productName}'>
                                ${snapshot.val()[key].productName}
                            </a>
                        </h5>

                        <div class="profile-block d-flex">
                            <p   id='price${i}'>
                                <del> 
                                ${snapshot.val()[key].price}

                                    </del>
                               
                                 <strong id='disprice${i}'>
                                ${snapshot.val()[key].disprice}
                                    
                                    
                                    </strong></p>
                        </div>

                     

                     
                    </div>
                    <div id='id${i}' value='${snapshot.val()[key].id}' class='idtxt'>${snapshot.val()[key].id}</div>

                    <div class="d-flex flex-column ms-auto" ${i++}>
                      
                    </div>
                </div>
            </div>

  </div>
  
                `;
                document.querySelector(".tabody").innerHTML +=`
            
            <tr>
                <td>${i} </td>
				<td> ${snapshot.val()[key].productName}</td>
				<td> ${snapshot.val()[key].quant}</td>
				<td> ${snapshot.val()[key].disprice}</td>

			</tr> `;
              
                
                
           


});




} else {
console.log("No data available");
}
}).catch((error) => {
console.error(error);
window.location.replace('error.html');
});




</script>
<!-- <script>



// Initialize Firebase
var firebaeConfig = {
    apiKey: "AIzaSyBQ75mL_tGG7DHgjh3u0_n_m-H6i3Qg_xM",
    authDomain: "test-pastmoos.firebaseapp.com",
    databaseURL: "https://test-pastmoos-default-rtdb.firebaseio.com",
    projectId: "test-pastmoos",
    storageBucket: "test-pastmoos.appspot.com",
    messagingSenderId: "130244640247",
    appId: "1:130244640247:web:62192c97a93d81ba95c2f2",
    measurementId: "G-XFD7NKTDZV"
  };
  firebase.initializeApp(firebaeConfig);

  // Get a reference to the Firebase Realtime Database
  var database = firebase.database();

//   function deleteData(i) {
//     // Specify the data to be deleted
//     var dataToDelete = {
// productName: document.getElementById('prodname' + i).textContent,
// phone: sessionStorage.getItem('userloggedin'),
// quant: document.getElementById('quant' + i).textContent,
// image: document.getElementById('img' + i).src,
// price: document.getElementById('price' + i).textContent,
// disprice: document.getElementById('disprice' + i).textContent 
      
//     };

//     // Get a reference to the node that contains the data to be deleted
//     var ref = database.ref('Cart/');

//     // Remove the specified data from the Firebase Realtime Database
//     ref.remove(dataToDelete, function(error) {
//       if (error) {
//         console.log('Data could not be deleted: ' + error);
//       } else {
//         console.log('Data deleted successfully.');
//       }
//     });
//   }



</script>
<script>
    function deleteProduct(i) {
        console.log(document.getElementById('prodname'+ i).textContent)
        var keyToRemove = null;
database.ref("Cart").orderByChild("productName").equalTo(document.getElementById('prodname'+ i).textContent).once("value", function(snapshot) {
  snapshot.forEach(function(childSnapshot) {
    keyToRemove = childSnapshot.key;
    console.log(childSnapshot.key);
  });
  database.ref("Cart/" + keyToRemove).remove();

});
}
</script> -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    
   // Initialize Firebase
var firebseConfig = {
  // Your Firebase configuration here
  apiKey: "AIzaSyBQ75mL_tGG7DHgjh3u0_n_m-H6i3Qg_xM",
authDomain: "test-pastmoos.firebaseapp.com",
databaseURL: "https://test-pastmoos-default-rtdb.firebaseio.com",
projectId: "test-pastmoos",
storageBucket: "test-pastmoos.appspot.com",
messagingSenderId: "130244640247",
appId: "1:130244640247:web:62192c97a93d81ba95c2f2",
measurementId: "G-XFD7NKTDZV"
};
firebase.initializeApp(firebseConfig);
var database = firebase.database();

// Get a reference to the "Cart" node
function remove(i){
    var idn= document.getElementById('id'+ i).textContent;
    database.ref('Cart/'+ idn).remove().then(()=>{
location.reload();


    });
}
 // Fetch Cart data from Firebase RDB
 firebase.auth().onAuthStateChanged(function(user) {
            if (user) {  
                const cartRef = database.ref('Cart').orderByChild('phone').equalTo(user.phoneNumber);
      cartRef.on('value', (snapshot) => {
        const cart = snapshot.val();

        // Compute total disprice
        let total = 0;
        for (const key in cart) {
          if (cart.hasOwnProperty(key)) {
            const dispriceStr = cart[key].disprice.trim().replace('Rs.', '');
            const dispriceNum = Number(dispriceStr);
            total += dispriceNum;
          }
        }

        const totalElem = document.getElementById('total');
        totalElem.textContent = `Total Price: Rs. ${total}`;
      });
     


            }else{
                window.location.replace('login.html')
            }
        
        
        
        });
 
</script>
<script>
     function order(){

window.location.href="order.html";
}
</script>
    </body>
</html>
